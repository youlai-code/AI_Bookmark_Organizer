

## 项目结构

```
bookmark-classifier/
├── manifest.json
├── background.js
├── content.js
├── popup/
│   ├── popup.html
│   ├── popup.js
│   └── popup.css
├── config.js
└── utils/
    ├── llm.js
    └── bookmark.js
```

## 核心实现步骤

### 1. manifest.json
```json
{
  "manifest_version": 3,
  "name": "智能书签分类器",
  "version": "1.0.0",
  "description": "使用LLM自动分类书签到合适的文件夹",
  "permissions": [
    "bookmarks",
    "activeTab",
    "storage",
    "scripting"
  ],
  "host_permissions": [
    "<all_urls>"
  ],
  "background": {
    "service_worker": "background.js"
  },
  "action": {
    "default_popup": "popup/popup.html"
  }
}
```

### 2. background.js (核心逻辑)
```javascript
import { classifyWithLLM } from './utils/llm.js';
import { createOrGetFolder, moveBookmark } from './utils/bookmark.js';

// 监听书签创建事件
chrome.bookmarks.onCreated.addListener(async (id, bookmark) => {
  if (!bookmark.url) return;
  
  try {
    // 获取网页内容
    const pageContent = await extractPageContent(bookmark.url);
    
    // 调用LLM分类
    const category = await classifyWithLLM(bookmark.title, bookmark.url, pageContent);
    
    // 创建或获取文件夹
    const folderId = await createOrGetFolder(category);
    
    // 移动书签
    await moveBookmark(id, folderId);
    
    console.log(`书签已分类到: ${category}`);
  } catch (error) {
    console.error('分类失败:', error);
  }
});

async function extractPageContent(url) {
  // 获取页面内容（标题、描述、关键词等）
  // 可以通过content script或直接fetch
  return { title: '', description: '', keywords: '' };
}
```

### 3. utils/llm.js (LLM接口)
```javascript
export async function classifyWithLLM(title, url, content) {
  const config = await chrome.storage.sync.get(['llmProvider', 'apiKey']);
  
  const prompt = `请分析以下网页信息，返回一个合适的书签分类文件夹名称（中文）：
标题: ${title}
URL: ${url}
内容摘要: ${content.description}

只返回文件夹名称，例如：技术文档、新闻资讯、购物、娱乐等。`;

  if (config.llmProvider === 'doubao') {
    return await callDoubao(prompt, config.apiKey);
  } else if (config.llmProvider === 'deepseek') {
    return await callDeepSeek(prompt, config.apiKey);
  }
}

async function callDeepSeek(prompt, apiKey) {
  const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: 'deepseek-chat',
      messages: [{ role: 'user', content: prompt }],
      temperature: 0.3
    })
  });
  
  const data = await response.json();
  return data.choices[0].message.content.trim();
}

async function callDoubao(prompt, apiKey) {
  // 豆包API调用实现
  // 参考豆包官方文档
}
```

### 4. utils/bookmark.js
```javascript
export async function createOrGetFolder(folderName) {
  const tree = await chrome.bookmarks.getTree();
  const bookmarksBar = tree[0].children.find(n => n.id === '1');
  
  // 查找是否已存在该文件夹
  const existing = bookmarksBar.children.find(
    n => n.title === folderName && !n.url
  );
  
  if (existing) {
    return existing.id;
  }
  
  // 创建新文件夹
  const folder = await chrome.bookmarks.create({
    parentId: '1',
    title: folderName
  });
  
  return folder.id;
}

export async function moveBookmark(bookmarkId, folderId) {
  await chrome.bookmarks.move(bookmarkId, { parentId: folderId });
}
```

### 5. popup/popup.html (配置界面)
```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <h3>智能书签分类设置</h3>
  
  <label>LLM提供商:</label>
  <select id="llmProvider">
    <option value="deepseek">DeepSeek</option>
    <option value="doubao">豆包</option>
  </select>
  
  <label>API Key:</label>
  <input type="password" id="apiKey" placeholder="输入API密钥">
  
  <button id="save">保存配置</button>
  
  <div id="status"></div>
  
  <script src="popup.js"></script>
</body>
</html>
```

## 关键技术点

1. **内容提取**: 使用content script或fetch获取网页元数据
2. **LLM调用**: 支持DeepSeek和豆包API
3. **书签管理**: 使用Chrome Bookmarks API
4. **配置存储**: 使用chrome.storage保存API密钥

需要我详细实现某个部分的代码吗？